{{!-- Mock/Real ë°ì´í„° ëª¨ë“œ í† ê¸€ ì»´í¬ë„ŒíŠ¸ - ì±…ê°ˆí”¼ ìŠ¤íƒ€ì¼ --}}
<div class="data-mode-toggle w-full" x-data="dataModeToggle()">
  {{!-- ì±…ê°ˆí”¼ íƒ­ --}}
  <div class="relative group w-full">
    {{!-- ì±…ê°ˆí”¼ ëª¨ì–‘ --}}
    <div class="bg-white border-2 border-b-0 rounded-t-xl shadow-lg transition-all duration-300 hover:translate-y-1 w-full"
         :class="status.mode === 'real' ? 'border-green-500' : 'border-orange-500'">
      
      {{!-- ìƒë‹¨ ë¦¬ë³¸ ì¥ì‹ --}}
      <div class="absolute -top-1 left-1/2 transform -translate-x-1/2 w-12 h-1.5 rounded-full"
           :class="status.mode === 'real' ? 'bg-green-500' : 'bg-orange-500'"></div>
      
      {{!-- ë©”ì¸ ë²„íŠ¼ --}}
      <button type="button"
              @click="toggleMode()"
              :disabled="isLoading"
              class="w-full px-4 py-2 pb-3 flex items-center justify-center space-x-2 cursor-pointer transition-all duration-200 group-hover:pb-4">
        
        {{!-- ì•„ì´ì½˜ --}}
        <div class="w-6 h-6 rounded-full flex items-center justify-center transition-all duration-300"
             :class="status.mode === 'real' ? 'bg-green-100' : 'bg-orange-100'">
          <i class="fas text-xs transition-all duration-300"
             :class="status.mode === 'real' ? 'fa-database text-green-600' : 'fa-flask text-orange-600'"></i>
        </div>

        {{!-- í…ìŠ¤íŠ¸ --}}
        <span class="text-xs font-bold uppercase tracking-wider transition-colors duration-300"
              :class="status.mode === 'real' ? 'text-green-600' : 'text-orange-600'"
              x-text="status.mode === 'real' ? 'REAL' : 'MOCK'"></span>

        {{!-- í† ê¸€ ì¸ë””ì¼€ì´í„° (ì‘ì€ ì ) --}}
        <div class="flex space-x-1">
          <div class="w-1.5 h-1.5 rounded-full transition-all duration-300"
               :class="status.mode === 'real' ? 'bg-gray-300' : 'bg-orange-500'"></div>
          <div class="w-1.5 h-1.5 rounded-full transition-all duration-300"
               :class="status.mode === 'real' ? 'bg-green-500' : 'bg-gray-300'"></div>
        </div>

        {{!-- ë¡œë”© ì¸ë””ì¼€ì´í„° --}}
        <div x-show="isLoading" class="ml-1">
          <svg class="animate-spin h-3 w-3 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </div>
      </button>
    </div>

    {{!-- í˜¸ë²„ ì‹œ íˆ´íŒ --}}
    <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50">
      <div class="bg-gray-900 text-white text-xs rounded-lg px-3 py-2 whitespace-nowrap">
        <span x-text="status.mode === 'real' ? 'Switch to Mock Data' : 'Switch to Real Data'"></span>
        <div class="absolute -top-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"></div>
      </div>
    </div>
  </div>
</div>

<style>
/* ì±…ê°ˆí”¼ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
.data-mode-toggle:hover .group > div:first-child {
  transform: translateY(2px);
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ (ìƒˆë¡œìš´ ë°ì´í„° ëª¨ë“œ ì•Œë¦¼) */
@keyframes pulse-bookmark {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.data-mode-toggle[data-just-toggled="true"] .group > div:first-child {
  animation: pulse-bookmark 0.5s ease-in-out 2;
}
</style>

<script>
function dataModeToggle() {
  return {
    status: {
      mode: 'mock', // ê¸°ë³¸ê°’
    },
    isLoading: false,

    init() {
      // ì´ˆê¸° ìƒíƒœ ë¡œë“œ
      this.loadCurrentStatus();
    },

    async loadCurrentStatus() {
      try {
        const response = await fetch('/dev-tools/api/data-mode/status');
        if (response.ok) {
          this.status = await response.json();
        }
      } catch (error) {
        console.error('ğŸš¨ Failed to load data mode status:', error);
      }
    },

    async toggleMode() {
      if (this.isLoading) return;
      
      this.isLoading = true;
      const newMode = this.status.mode === 'real' ? 'mock' : 'real';
      
      console.log(`ğŸ”„ Switching from ${this.status.mode} to ${newMode}`);

      try {
        const response = await fetch('/dev-tools/api/data-mode/preference', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ mode: newMode })
        });

        if (response.ok) {
          // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
          this.$el.setAttribute('data-just-toggled', 'true');
          setTimeout(() => {
            // ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            window.location.reload();
          }, 300);
        } else {
          console.error('ğŸš¨ Failed to toggle data mode');
          this.isLoading = false;
        }
      } catch (error) {
        console.error('ğŸš¨ Error toggling data mode:', error);
        this.isLoading = false;
      }
    }
  }
}
</script>