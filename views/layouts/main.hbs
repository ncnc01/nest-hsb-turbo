<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{title}} - Admin Panel</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              900: '#1e3a8a',
            }
          }
        }
      }
    }
  </script>
  
  <!-- Custom Components CSS -->
  <link rel="stylesheet" href="/public/css/components.css">
  
  
  <!-- Turbo -->
  <script src="https://unpkg.com/@hotwired/turbo@7.3.0/dist/turbo.es2017-umd.js"></script>
  <script>
    // Turbo Drive ìµœì í™” ì„¤ì •
    window.Turbo = window.Turbo || {};
    window.Turbo.session = window.Turbo.session || {};
    
    // ì¦‰ì‹œ ë Œë”ë§ê³¼ ë¶€ë“œëŸ¬ìš´ ì „í™˜ì„ ìœ„í•œ ì„¤ì •
    window.Turbo.session.drive = true;
    window.Turbo.session.cacheTimestampParam = "_turbo_cache";
    
    // ê¹œë¹¡ì„ ë°©ì§€ë¥¼ ìœ„í•œ ì„¤ì •
    document.addEventListener('turbo:before-visit', function(event) {
      // ì‚¬ì´ë“œë°” ìƒíƒœ ì €ì¥
      const sidebarOpen = document.querySelector('#sidebar-manager [x-data]')?.__x?.$data?.sidebarOpen;
      if (typeof sidebarOpen !== 'undefined') {
        sessionStorage.setItem('sidebarState', JSON.stringify({
          open: sidebarOpen,
          timestamp: Date.now()
        }));
      }
    });
    
    document.addEventListener('turbo:load', function(event) {
      // ì‚¬ì´ë“œë°” ìƒíƒœ ë³µì›
      const savedState = sessionStorage.getItem('sidebarState');
      if (savedState) {
        try {
          const state = JSON.parse(savedState);
          // 5ë¶„ ì´ë‚´ì˜ ìƒíƒœë§Œ ë³µì›
          if (Date.now() - state.timestamp < 300000) {
            const sidebarManager = document.querySelector('#sidebar-manager [x-data]')?.__x;
            if (sidebarManager && sidebarManager.$data) {
              sidebarManager.$data.sidebarOpen = state.open;
            }
          }
        } catch (e) {
          console.log('ì‚¬ì´ë“œë°” ìƒíƒœ ë³µì› ì‹¤íŒ¨:', e);
        }
      }
    });
    
    // Turbo ë¡œë”© ì„¤ì • (ì˜µì…”ë„)
    window.TURBO_LOADING_ENABLED = false; // ê¸°ë³¸ê°’: false (ë¡œë”© í™”ë©´ ë¹„í™œì„±í™”)
    
    // Turbo ë¡œë”© ìƒíƒœ ì¶”ì 
    let turboLoadingActive = false;
    
    // ë¡œë”© ìƒíƒœ ì„¤ì • í•¨ìˆ˜
    function setTurboLoading(loading) {
      // ë¡œë”©ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
      if (!window.TURBO_LOADING_ENABLED) {
        return;
      }
      
      turboLoadingActive = loading;
      if (loading) {
        document.documentElement.classList.add('turbo-loading');
      } else {
        document.documentElement.classList.remove('turbo-loading');
      }
      console.log(loading ? 'ğŸ”„ Turbo loading started' : 'âœ… Turbo loading finished');
    }
    
    // ë¡œë”© í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
    window.enableTurboLoading = function(enabled = true) {
      window.TURBO_LOADING_ENABLED = enabled;
      if (!enabled && turboLoadingActive) {
        // ë¡œë”©ì„ ë¹„í™œì„±í™”í•˜ë©´ í˜„ì¬ ë¡œë”© ìƒíƒœë„ ì¢…ë£Œ
        turboLoadingActive = false;
        document.documentElement.classList.remove('turbo-loading');
        console.log('ğŸš« Turbo loading disabled');
      }
      console.log(`âš™ï¸ Turbo loading ${enabled ? 'enabled' : 'disabled'}`);
    }
    
    // Turbo ë””ë²„ê¹… ë° ì„¤ì •
    document.addEventListener('turbo:before-visit', (event) => {
      console.log('ğŸš€ Turbo visit starting to:', event.detail.url);
      setTurboLoading(true);
    });
    
    document.addEventListener('turbo:visit', (event) => {
      console.log('ğŸ”„ Turbo visit in progress');
      setTurboLoading(true);
    });
    
    document.addEventListener('turbo:load', (event) => {
      console.log('âœ… Turbo load complete');
      setTurboLoading(false);
    });
    
    document.addEventListener('turbo:frame-load', (event) => {
      console.log('ğŸ–¼ï¸ Turbo frame loaded:', event.target.id);
      // í”„ë ˆì„ ë¡œë”©ì´ ì™„ë£Œë˜ë©´ ì „ì²´ ë¡œë”©ë„ ì™„ë£Œë¡œ ê°„ì£¼
      if (event.target.id === 'main-content') {
        setTurboLoading(false);
      }
    });
    
    document.addEventListener('turbo:before-frame-render', (event) => {
      console.log('ğŸ¨ Turbo frame render:', event.target.id);
    });
    
    document.addEventListener('turbo:frame-render', (event) => {
      console.log('ğŸ¨ Turbo frame rendered:', event.target.id);
      // ë©”ì¸ ì½˜í…ì¸  í”„ë ˆì„ì´ ë Œë”ë§ë˜ë©´ ë¡œë”© ì™„ë£Œ
      if (event.target.id === 'main-content') {
        setTurboLoading(false);
      }
    });
    
    // ì¶”ê°€ ì•ˆì „ì¥ì¹˜: ì¼ì • ì‹œê°„ í›„ ê°•ì œë¡œ ë¡œë”© ì¢…ë£Œ
    let loadingTimeoutId = null;
    document.addEventListener('turbo:before-visit', () => {
      // ê¸°ì¡´ íƒ€ì„ì•„ì›ƒ í´ë¦¬ì–´
      if (loadingTimeoutId) {
        clearTimeout(loadingTimeoutId);
      }
      // 3ì´ˆ í›„ ê°•ì œ ì¢…ë£Œ (ë” ì§§ê²Œ ì„¤ì •)
      loadingTimeoutId = setTimeout(() => {
        console.warn('âš ï¸ Turbo loading timeout - force ending');
        turboLoadingActive = false;
        document.documentElement.classList.remove('turbo-loading');
        loadingTimeoutId = null;
      }, 3000);
    });
    
    // ë¡œë”© ì™„ë£Œì‹œ íƒ€ì„ì•„ì›ƒ í´ë¦¬ì–´
    function clearLoadingTimeout() {
      if (loadingTimeoutId) {
        clearTimeout(loadingTimeoutId);
        loadingTimeoutId = null;
      }
    }
    
    // ëª¨ë“  ë¡œë”© ì™„ë£Œ ì´ë²¤íŠ¸ì—ì„œ íƒ€ì„ì•„ì›ƒ í´ë¦¬ì–´
    document.addEventListener('turbo:load', clearLoadingTimeout);
    document.addEventListener('turbo:frame-load', clearLoadingTimeout);
    document.addEventListener('turbo:frame-render', clearLoadingTimeout);
    
    // Turboì™€ Alpine.js í˜¸í™˜ì„± ì„¤ì •
    document.addEventListener('turbo:before-render', () => {
      console.log('ğŸ§¹ Cleaning up Alpine before render');
      // Alpine ì •ë¦¬ (ì‚¬ì´ë“œë°” ì œì™¸)
      if (window.Alpine) {
        document.querySelectorAll('[x-data]:not([data-permanent-element])').forEach(el => {
          if (el._x_dataStack) {
            el._x_dataStack.forEach(data => {
              if (data.$destroy) data.$destroy();
            });
          }
        });
      }
    });
    
    document.addEventListener('turbo:render', () => {
      console.log('ğŸ”§ Re-initializing Alpine after render');
      // Alpine ì¬ì´ˆê¸°í™” (ì‚¬ì´ë“œë°” ì œì™¸)
      if (window.Alpine) {
        const wrapper = document.querySelector('#main-content-wrapper');
        if (wrapper) {
          Alpine.initTree(wrapper);
        }
      }
    });
    
    // ìºì‹œ ìµœì í™”
    document.addEventListener('turbo:before-cache', () => {
      console.log('ğŸ’¾ Preparing Turbo cache');
      // ìºì‹œ ì „ ì •ë¦¬ ì‘ì—…
      document.querySelectorAll('[data-turbo-temporary]').forEach(el => el.remove());
    });
    
    // í˜ì´ì§€ ì™„ì „ ë¡œë”© ì‹œì—ë„ ì•ˆì „ì¥ì¹˜ (ë” ê°•ë ¥í•˜ê²Œ)
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        console.log('ğŸ“„ DOMContentLoaded - force ending loading state');
        turboLoadingActive = false;
        document.documentElement.classList.remove('turbo-loading');
        clearLoadingTimeout();
      }, 100);
    });
    
    // ìœˆë„ìš° ë¡œë“œ ì™„ë£Œ ì‹œ ìµœì¢… ì•ˆì „ì¥ì¹˜
    window.addEventListener('load', () => {
      setTimeout(() => {
        console.log('ğŸŒ Window load complete - force ending loading state');
        turboLoadingActive = false;
        document.documentElement.classList.remove('turbo-loading');
        clearLoadingTimeout();
        
        // Loading.jsì˜ ëª¨ë“  ë¡œë”©ë„ ì •ë¦¬
        if (window.clearAllLoadings) {
          window.clearAllLoadings();
        }
      }, 200);
    });
    
    // ì¶”ê°€ ì´ë²¤íŠ¸ë¡œ ë¡œë”© ìƒíƒœ ê°•ì œ ì¢…ë£Œ
    document.addEventListener('turbo:frame-render', (event) => {
      if (event.target.id === 'main-content') {
        setTimeout(() => {
          console.log('ğŸ¯ Main content rendered - force ending all loading');
          turboLoadingActive = false;
          document.documentElement.classList.remove('turbo-loading');
          clearLoadingTimeout();
          
          if (window.clearAllLoadings) {
            window.clearAllLoadings();
          }
        }, 100);
      }
    });
    
    // í˜ì´ì§€ ë³€ê²½ ì™„ë£Œ í›„ ì•ˆì „ì¥ì¹˜
    document.addEventListener('turbo:visit', () => {
      // 5ì´ˆ í›„ ê°•ì œ ì¢…ë£Œ (ë” ê¸´ íƒ€ì„ì•„ì›ƒ)
      setTimeout(() => {
        console.warn('ğŸš¨ Emergency loading cleanup - 5 second timeout');
        turboLoadingActive = false;
        document.documentElement.classList.remove('turbo-loading');
        clearLoadingTimeout();
        
        if (window.clearAllLoadings) {
          window.clearAllLoadings();
        }
      }, 5000);
    });
    
    // ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°•ì œ ë¡œë”© ì •ë¦¬ í•¨ìˆ˜
    window.forceStopLoading = function() {
      console.log('ğŸ›‘ Force stopping all loading states...');
      
      // Turbo ë¡œë”© ì •ë¦¬
      turboLoadingActive = false;
      document.documentElement.classList.remove('turbo-loading');
      clearLoadingTimeout();
      
      // Loading.js ë¡œë”© ì •ë¦¬
      if (window.clearAllLoadings) {
        window.clearAllLoadings();
      }
      
      // Loading.jsì˜ ì „ì—­ ë¡œë”©ë„ ì§ì ‘ ì •ë¦¬
      if (window.Loading) {
        window.Loading.hideAll();
      }
      
      console.log('âœ… All loading states cleared');
    };
    
    console.log('ğŸš€ Turbo loading management initialized. Use forceStopLoading() to manually clear loading states.');
  </script>
  
  <!-- Alpine.js -->
  <script defer src="https://unpkg.com/alpinejs@3.13.0/dist/cdn.min.js" data-turbo-permanent></script>
  
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart Libraries (loaded once) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js" data-turbo-permanent></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js" data-turbo-permanent></script>
  <script src="https://d3js.org/d3.v7.min.js" data-turbo-permanent></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" data-turbo-permanent></script>
  <script src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js" data-turbo-permanent></script>

  <!-- Editor Libraries -->
  <!-- TinyMCE -->
  <script src="https://cdn.tiny.cloud/1/fmej1elogke795ozwx1e6g5hhpz0l57egzflef2djimivy0y/tinymce/8/tinymce.min.js" referrerpolicy="origin" crossorigin="anonymous" data-turbo-permanent></script>
  
  <!-- CKEditor5 -->
  <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js" data-turbo-permanent></script>
  
  <!-- Quill.js -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js" data-turbo-permanent></script>
  
  <!-- Monaco Editor -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js" data-turbo-permanent></script>
  
  
  
  
  <style>
    /* ê¹œë°•ì„ ë°©ì§€ ìŠ¤íƒ€ì¼ */
    [x-cloak] { display: none !important; }
    
    /* Turboë¡œë”© ì¤‘ ê¹œë°•ì„ ë°©ì§€ */
    html.turbo-loading body {
      opacity: 0.95;
      transition: opacity 150ms ease-out;
    }
    
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ë¡œ FOUC ë°©ì§€ */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f9fafb;
      transition: opacity 150ms ease-in;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    /* ì¤‘ìš”í•œ UI ìš”ì†Œë“¤ì˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .btn {
      display: inline-flex;
      align-items: center;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      transition: all 150ms ease;
    }
    
    /* ì‚¬ì´ë“œë°” ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .sidebar-base {
      background: white;
      border-right: 1px solid #e5e7eb;
    }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ - ì‚¬ì´ë“œë°” ê³µê°„ í™•ë³´ */
    #main-content-wrapper {
      margin-left: 256px; /* ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ì´ë“œë°” ë„ˆë¹„ë§Œí¼ ë§ˆì§„ */
      width: calc(100% - 256px); /* ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³µê°„ ì‚¬ìš© */
      transition: margin-left 300ms ease-in-out, width 300ms ease-in-out;
      position: relative;
      z-index: 10; /* ì‚¬ì´ë“œë°”ë³´ë‹¤ ë‚®ì§€ë§Œ ì½˜í…ì¸  ë³´ì¥ */
      min-height: 100vh;
      box-sizing: border-box;
    }
    
    /* ì‚¬ì´ë“œë°”ê°€ ì¶•ì†Œë˜ì—ˆì„ ë•Œë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ - ìš°ì„ ìˆœìœ„ ê°•í™” */
    body.sidebar-collapsed #main-content-wrapper,
    .sidebar-collapsed #main-content-wrapper {
      margin-left: 64px !important; /* ì¶•ì†Œëœ ì‚¬ì´ë“œë°” ë„ˆë¹„ë§Œí¼ */
      width: calc(100% - 64px) !important; /* ì¶•ì†Œëœ ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³µê°„ ì‚¬ìš© */
    }
    
    /* Alpine.js x-show ìƒíƒœì— ë”°ë¥¸ ì§ì ‘ ëŒ€ì‘ */
    #main-content-wrapper[data-sidebar-collapsed="true"] {
      margin-left: 64px !important;
      width: calc(100% - 64px) !important;
    }
    
    /* ë‚´ë¶€ ì½˜í…ì¸ ê°€ ì „ì²´ ë„ˆë¹„ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œ */
    #main-content-wrapper {
      /* í™•ì¥ì„±ì„ ìœ„í•´ flex ì‚¬ìš© */
      display: flex;
      flex-direction: column;
    }
    
    #main-content-wrapper > * {
      width: 100%;
      max-width: none !important;
      flex: 1;
    }
    
    /* main ìš”ì†Œë„ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
    #main-content-wrapper main {
      width: 100%;
      max-width: none !important;
    }
    
    /* turbo-frameë„ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
    #main-content-wrapper turbo-frame {
      width: 100%;
      max-width: none !important;
      display: block;
    }
    
    /* ëª¨ë“  í•˜ìœ„ ìš”ì†Œë“¤ì´ ìµœëŒ€ ë„ˆë¹„ ì œí•œì„ ê°–ì§€ ì•Šë„ë¡ */
    #main-content-wrapper * {
      max-width: none !important;
    }
    
    /* ëŒ€ì‹œë³´ë“œ íŠ¹ì • ìš”ì†Œë“¤ */
    #dashboard-container,
    #dashboard-container * {
      max-width: none !important;
    }
    
    /* Grid ì»¨í…Œì´ë„ˆë“¤ë„ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
    .grid {
      width: 100% !important;
      max-width: none !important;
    }
    
    /* FooterëŠ” main-content-wrapperì™€ ë™ì¼í•˜ê²Œ ì‚¬ì´ë“œë°” ì˜†ì— ìœ„ì¹˜ */
    footer {
      margin-left: 256px; /* ì‚¬ì´ë“œë°” ë„ˆë¹„ë§Œí¼ ë§ˆì§„ */
      width: calc(100% - 256px); /* ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³µê°„ ì‚¬ìš© */
      transition: margin-left 300ms ease-in-out, width 300ms ease-in-out;
      position: relative;
      z-index: 10;
    }
    
    /* ì‚¬ì´ë“œë°”ê°€ ì¶•ì†Œë˜ì—ˆì„ ë•Œ Footerë„ ì¡°ì • */
    body.sidebar-collapsed footer,
    .sidebar-collapsed footer {
      margin-left: 64px !important; /* ì¶•ì†Œëœ ì‚¬ì´ë“œë°” ë„ˆë¹„ë§Œí¼ */
      width: calc(100% - 64px) !important; /* ì¶•ì†Œëœ ì‚¬ì´ë“œë°” ë„ˆë¹„ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³µê°„ ì‚¬ìš© */
    }
    
    /* ëª¨ë°”ì¼ì—ì„œëŠ” ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
    @media (max-width: 768px) {
      #main-content-wrapper {
        margin-left: 0 !important;
        width: 100% !important; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì „ì²´ ë„ˆë¹„ */
      }
      
      .sidebar-collapsed #main-content-wrapper {
        margin-left: 0 !important;
        width: 100% !important;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ Footerë„ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
      footer {
        margin-left: 0 !important;
        width: 100% !important;
      }
    }
  </style>
</head>
<body>
  
  <!-- Sidebar (Persistent) -->
  <div id="persistent-sidebar" data-turbo-permanent>
    {{> sidebar}}
  </div>
  
  <!-- Main Content Area -->
  <div id="main-content-wrapper" class="transition-all duration-300 ease-in-out">
    
    <!-- Mobile Header Bar -->
    {{!-- <div class="md:hidden bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
      <div class="flex items-center justify-between h-16 px-4">
        <button
          onclick="document.querySelector('[x-data*=\"sidebarManager\"]').__x.$data.toggleSidebar()"
          class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
        >
          <i class="fas fa-bars text-xl"></i>
        </button>
        <h2 class="text-lg font-semibold text-gray-900">Admin Panel</h2>
        <div class="w-10"></div>  
      </div>
    </div> --}}
    
    <!-- Top Header -->
    {{> header}}
    
    <!-- Main Content -->
    <main class="bg-gray-50 p-6">
      {{{body}}}
    </main>
    
  </div>
  
  <!-- Footer (Outside of main-content-wrapper) -->
  {{> footer}}

  
  <!-- Socket.io for dev reload (development only) -->
  {{#if isDevelopment}}
  <script src="/socket.io/socket.io.js" data-turbo-permanent></script>
  <script src="/public/js/dev-reload.js" data-turbo-permanent></script>
  <script src="/public/js/class-helper.js" data-turbo-permanent></script>
  <script src="/public/js/interactive-dev.js" data-turbo-permanent></script>
  {{/if}}
  
  <!-- Error Handling & UI Systems -->
  <script src="/public/js/toast.js" data-turbo-permanent></script>
  <script src="/public/js/modal.js" data-turbo-permanent></script>
  <script src="/public/js/alert.js" data-turbo-permanent></script>
  <script src="/public/js/loading.js" data-turbo-permanent></script>
  <script src="/public/js/debounce.js" data-turbo-permanent></script>
  <script src="/public/js/api.js" data-turbo-permanent></script>
  
  <!-- Dashboard Components -->
  <script src="/public/js/components/data-provider.js" data-turbo-permanent></script>
  <script src="/public/js/components/chart-manager.js" data-turbo-permanent></script>

  <!-- Table Manager -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" data-turbo-permanent></script>
  <script src="/public/js/table-manager.js" data-turbo-permanent></script>
  <script src="/public/js/ag-grid-test.js" data-turbo-permanent></script>

  <!-- Browser Interaction Logger -->
  <script src="/public/js/interaction-logger.js" data-turbo-permanent></script>

  <!-- Editor Manager (Simple Version) -->
  <script src="/public/js/editors-simple.js" data-turbo-permanent></script>

  <!-- Custom Scripts -->
  <script src="/public/js/app.js" data-turbo-permanent></script>
</body>
</html>