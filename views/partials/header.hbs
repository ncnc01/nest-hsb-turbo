<!-- Top Header -->
<header class="bg-white shadow-sm border-b border-gray-200" data-turbo-permanent>
  <div class="px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      
      <!-- Left side -->
      <div class="flex items-center">
        <!-- Mobile menu button -->
        <button 
          onclick="toggleMobileSidebar()"
          class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
        >
          <i class="fas fa-bars"></i>
        </button>
        
        <!-- Page title -->
        <div class="ml-4 md:ml-0">
          <h2 class="text-lg font-semibold text-gray-900">{{title}}</h2>
          {{#if subtitle}}
          <p class="text-sm text-gray-500">{{subtitle}}</p>
          {{/if}}
        </div>
      </div>

      <!-- Right side -->
      <div class="flex items-center space-x-4">
        
        <!-- Notifications -->
        <div class="relative" id="notifications-dropdown">
          <button 
            onclick="toggleNotifications()"
            class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 relative"
          >
            <i class="fas fa-bell"></i>
            <span class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 rounded-full flex items-center justify-center text-xs text-white">
              3
            </span>
          </button>
          
          <!-- Notifications dropdown -->
          <div 
            id="notifications-menu"
            class="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <div class="px-4 py-2 border-b border-gray-200">
                <h3 class="text-sm font-medium text-gray-900">알림</h3>
              </div>
              
              <!-- Notification items -->
              <div class="max-h-64 overflow-y-auto">
                <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-question-circle text-blue-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">새 문의사항</p>
                      <p class="text-sm text-gray-500 truncate">웹사이트 접속 문제에 대한 문의가...</p>
                      <p class="text-xs text-gray-400 mt-1">5분 전</p>
                    </div>
                  </div>
                </a>
                
                <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-check-circle text-green-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">답변 완료</p>
                      <p class="text-sm text-gray-500 truncate">결제 관련 문의에 대한 답변이...</p>
                      <p class="text-xs text-gray-400 mt-1">1시간 전</p>
                    </div>
                  </div>
                </a>
                
                <a href="#" class="block px-4 py-3 hover:bg-gray-50">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">시스템 알림</p>
                      <p class="text-sm text-gray-500 truncate">정기 점검이 예정되어 있습니다.</p>
                      <p class="text-xs text-gray-400 mt-1">2시간 전</p>
                    </div>
                  </div>
                </a>
              </div>
              
              <div class="px-4 py-2 border-t border-gray-200">
                <a href="/notifications" class="text-sm text-primary-600 hover:text-primary-700">
                  모든 알림 보기
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="relative" id="quick-actions-dropdown">
          <button 
            onclick="toggleQuickActions()"
            class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
          >
            <i class="fas fa-plus"></i>
          </button>
          
          <!-- Quick actions dropdown -->
          <div 
            id="quick-actions-menu"
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <a 
                href="/inquiry/create" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-plus mr-2"></i>
                새 문의 등록
              </a>
              <a 
                href="/users/create" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-user-plus mr-2"></i>
                사용자 추가
              </a>
              <a 
                href="/reports/generate" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-file-alt mr-2"></i>
                리포트 생성
              </a>
            </div>
          </div>
        </div>

        <!-- User menu -->
        <div class="relative" id="user-menu-dropdown">
          <button 
            onclick="toggleUserMenu()"
            class="flex items-center space-x-2 p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
          >
            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
              <i class="fas fa-user text-gray-600 text-sm"></i>
            </div>
            <span class="hidden sm:block text-sm font-medium text-gray-700">Admin</span>
            <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
          </button>
          
          <!-- User dropdown -->
          <div 
            id="user-menu"
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <a 
                href="/profile" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeUserMenu()"
              >
                <i class="fas fa-user mr-2"></i>
                프로필
              </a>
              <a 
                href="/settings" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeUserMenu()"
              >
                <i class="fas fa-cog mr-2"></i>
                설정
              </a>
              <div class="border-t border-gray-100"></div>
              <form action="/auth/logout" method="POST" data-turbo-method="post" class="block">
                <button 
                  type="submit"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                  onclick="closeUserMenu()"
                >
                  <i class="fas fa-sign-out-alt mr-2"></i>
                  로그아웃
                </button>
              </form>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</header>

<script>
// 모바일 사이드바 토글 함수
function toggleMobileSidebar() {
  console.log('햄버거 메뉴 클릭됨');
  
  // 커스텀 이벤트 발생
  window.dispatchEvent(new CustomEvent('toggle-mobile-sidebar'));
  
  // 직접 Alpine.js 컴포넌트 접근 시도
  setTimeout(() => {
    const sidebarManager = document.querySelector('#sidebar-manager [x-data]');
    if (sidebarManager && sidebarManager.__x && sidebarManager.__x.$data) {
      const alpineData = sidebarManager.__x.$data;
      console.log('현재 사이드바 상태:', alpineData.sidebarOpen, 'isMobile:', alpineData.isMobile);
      
      if (alpineData.isMobile) {
        alpineData.sidebarOpen = !alpineData.sidebarOpen;
        console.log('모바일 사이드바 토글됨:', alpineData.sidebarOpen);
      } else {
        alpineData.toggleSidebar();
      }
    } else {
      console.error('Alpine.js 사이드바 컴포넌트를 찾을 수 없습니다');
    }
  }, 100);
}

// 헤더 드롭다운 관리 (순수 JavaScript)
let openDropdown = null;

// 알림 드롭다운
function toggleNotifications() {
  const menu = document.getElementById('notifications-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

// Quick Actions 드롭다운
function toggleQuickActions() {
  const menu = document.getElementById('quick-actions-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

function closeQuickActions() {
  const menu = document.getElementById('quick-actions-menu');
  closeDropdown(menu);
  openDropdown = null;
}

// User Menu 드롭다운
function toggleUserMenu() {
  const menu = document.getElementById('user-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

function closeUserMenu() {
  const menu = document.getElementById('user-menu');
  closeDropdown(menu);
  openDropdown = null;
}

// 드롭다운 표시 함수
function showDropdown(menu) {
  menu.classList.remove('hidden');
  setTimeout(() => {
    menu.classList.remove('opacity-0', 'scale-95');
    menu.classList.add('opacity-100', 'scale-100');
  }, 10);
}

// 드롭다운 숨김 함수
function closeDropdown(menu) {
  menu.classList.remove('opacity-100', 'scale-100');
  menu.classList.add('opacity-0', 'scale-95');
  setTimeout(() => {
    menu.classList.add('hidden');
  }, 200);
}

// 모든 드롭다운 닫기
function closeAllDropdowns() {
  const dropdowns = ['notifications-menu', 'quick-actions-menu', 'user-menu'];
  dropdowns.forEach(id => {
    const menu = document.getElementById(id);
    if (menu && !menu.classList.contains('hidden')) {
      closeDropdown(menu);
    }
  });
  openDropdown = null;
}

// 외부 클릭 시 드롭다운 닫기
document.addEventListener('click', function(event) {
  if (openDropdown && !openDropdown.parentElement.contains(event.target)) {
    closeAllDropdowns();
  }
});

// Escape 키로 드롭다운 닫기
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape' && openDropdown) {
    closeAllDropdowns();
  }
});

console.log('📋 헤더 순수 JavaScript 드롭다운 시스템 로드됨');
</script>