<!-- Top Header -->
<header class="bg-white shadow-sm border-b border-gray-200" data-turbo-permanent>
  <div class="px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      
      <!-- Left side -->
      <div class="flex items-center">
        <!-- Mobile menu button -->
        <button 
          onclick="toggleMobileSidebar()"
          class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
        >
          <i class="fas fa-bars"></i>
        </button>
        
        <!-- Page title -->
        <div class="ml-4 md:ml-0">
          <h2 class="text-lg font-semibold text-gray-900">{{title}}</h2>
          {{#if subtitle}}
          <p class="text-sm text-gray-500">{{subtitle}}</p>
          {{/if}}
        </div>
      </div>

      <!-- Right side -->
      <div class="flex items-center space-x-4">
        
        <!-- Notifications -->
        <div class="relative" id="notifications-dropdown">
          <button 
            onclick="toggleNotifications()"
            class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 relative"
          >
            <i class="fas fa-bell"></i>
            <span class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 rounded-full flex items-center justify-center text-xs text-white">
              3
            </span>
          </button>
          
          <!-- Notifications dropdown -->
          <div 
            id="notifications-menu"
            class="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <div class="px-4 py-2 border-b border-gray-200">
                <h3 class="text-sm font-medium text-gray-900">ì•Œë¦¼</h3>
              </div>
              
              <!-- Notification items -->
              <div class="max-h-64 overflow-y-auto">
                <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-question-circle text-blue-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">ìƒˆ ë¬¸ì˜ì‚¬í•­</p>
                      <p class="text-sm text-gray-500 truncate">ì›¹ì‚¬ì´íŠ¸ ì ‘ì† ë¬¸ì œì— ëŒ€í•œ ë¬¸ì˜ê°€...</p>
                      <p class="text-xs text-gray-400 mt-1">5ë¶„ ì „</p>
                    </div>
                  </div>
                </a>
                
                <a href="#" class="block px-4 py-3 hover:bg-gray-50 border-b border-gray-100">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-check-circle text-green-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">ë‹µë³€ ì™„ë£Œ</p>
                      <p class="text-sm text-gray-500 truncate">ê²°ì œ ê´€ë ¨ ë¬¸ì˜ì— ëŒ€í•œ ë‹µë³€ì´...</p>
                      <p class="text-xs text-gray-400 mt-1">1ì‹œê°„ ì „</p>
                    </div>
                  </div>
                </a>
                
                <a href="#" class="block px-4 py-3 hover:bg-gray-50">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-sm"></i>
                      </div>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-sm font-medium text-gray-900">ì‹œìŠ¤í…œ ì•Œë¦¼</p>
                      <p class="text-sm text-gray-500 truncate">ì •ê¸° ì ê²€ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                      <p class="text-xs text-gray-400 mt-1">2ì‹œê°„ ì „</p>
                    </div>
                  </div>
                </a>
              </div>
              
              <div class="px-4 py-2 border-t border-gray-200">
                <a href="/notifications" class="text-sm text-primary-600 hover:text-primary-700">
                  ëª¨ë“  ì•Œë¦¼ ë³´ê¸°
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="relative" id="quick-actions-dropdown">
          <button 
            onclick="toggleQuickActions()"
            class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
          >
            <i class="fas fa-plus"></i>
          </button>
          
          <!-- Quick actions dropdown -->
          <div 
            id="quick-actions-menu"
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <a 
                href="/inquiry/create" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-plus mr-2"></i>
                ìƒˆ ë¬¸ì˜ ë“±ë¡
              </a>
              <a 
                href="/users/create" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-user-plus mr-2"></i>
                ì‚¬ìš©ì ì¶”ê°€
              </a>
              <a 
                href="/reports/generate" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeQuickActions()"
              >
                <i class="fas fa-file-alt mr-2"></i>
                ë¦¬í¬íŠ¸ ìƒì„±
              </a>
            </div>
          </div>
        </div>

        <!-- User menu -->
        <div class="relative" id="user-menu-dropdown">
          <button 
            onclick="toggleUserMenu()"
            class="flex items-center space-x-2 p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500"
          >
            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
              <i class="fas fa-user text-gray-600 text-sm"></i>
            </div>
            <span class="hidden sm:block text-sm font-medium text-gray-700">Admin</span>
            <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
          </button>
          
          <!-- User dropdown -->
          <div 
            id="user-menu"
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50 hidden transition-all duration-200 transform opacity-0 scale-95"
            style="transition: opacity 200ms ease-out, transform 200ms ease-out;"
          >
            <div class="py-1">
              <a 
                href="/profile" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeUserMenu()"
              >
                <i class="fas fa-user mr-2"></i>
                í”„ë¡œí•„
              </a>
              <a 
                href="/settings" 
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                onclick="closeUserMenu()"
              >
                <i class="fas fa-cog mr-2"></i>
                ì„¤ì •
              </a>
              <div class="border-t border-gray-100"></div>
              <form action="/auth/logout" method="POST" data-turbo-method="post" class="block">
                <button 
                  type="submit"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                  onclick="closeUserMenu()"
                >
                  <i class="fas fa-sign-out-alt mr-2"></i>
                  ë¡œê·¸ì•„ì›ƒ
                </button>
              </form>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</header>

<script>
// ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í† ê¸€ í•¨ìˆ˜
function toggleMobileSidebar() {
  console.log('í–„ë²„ê±° ë©”ë‰´ í´ë¦­ë¨');
  
  // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ
  window.dispatchEvent(new CustomEvent('toggle-mobile-sidebar'));
  
  // ì§ì ‘ Alpine.js ì»´í¬ë„ŒíŠ¸ ì ‘ê·¼ ì‹œë„
  setTimeout(() => {
    const sidebarManager = document.querySelector('#sidebar-manager [x-data]');
    if (sidebarManager && sidebarManager.__x && sidebarManager.__x.$data) {
      const alpineData = sidebarManager.__x.$data;
      console.log('í˜„ì¬ ì‚¬ì´ë“œë°” ìƒíƒœ:', alpineData.sidebarOpen, 'isMobile:', alpineData.isMobile);
      
      if (alpineData.isMobile) {
        alpineData.sidebarOpen = !alpineData.sidebarOpen;
        console.log('ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í† ê¸€ë¨:', alpineData.sidebarOpen);
      } else {
        alpineData.toggleSidebar();
      }
    } else {
      console.error('Alpine.js ì‚¬ì´ë“œë°” ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
  }, 100);
}

// í—¤ë” ë“œë¡­ë‹¤ìš´ ê´€ë¦¬ (ìˆœìˆ˜ JavaScript)
let openDropdown = null;

// ì•Œë¦¼ ë“œë¡­ë‹¤ìš´
function toggleNotifications() {
  const menu = document.getElementById('notifications-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

// Quick Actions ë“œë¡­ë‹¤ìš´
function toggleQuickActions() {
  const menu = document.getElementById('quick-actions-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

function closeQuickActions() {
  const menu = document.getElementById('quick-actions-menu');
  closeDropdown(menu);
  openDropdown = null;
}

// User Menu ë“œë¡­ë‹¤ìš´
function toggleUserMenu() {
  const menu = document.getElementById('user-menu');
  if (openDropdown && openDropdown !== menu) {
    closeAllDropdowns();
  }
  
  if (menu.classList.contains('hidden')) {
    showDropdown(menu);
    openDropdown = menu;
  } else {
    closeDropdown(menu);
    openDropdown = null;
  }
}

function closeUserMenu() {
  const menu = document.getElementById('user-menu');
  closeDropdown(menu);
  openDropdown = null;
}

// ë“œë¡­ë‹¤ìš´ í‘œì‹œ í•¨ìˆ˜
function showDropdown(menu) {
  menu.classList.remove('hidden');
  setTimeout(() => {
    menu.classList.remove('opacity-0', 'scale-95');
    menu.classList.add('opacity-100', 'scale-100');
  }, 10);
}

// ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€ í•¨ìˆ˜
function closeDropdown(menu) {
  menu.classList.remove('opacity-100', 'scale-100');
  menu.classList.add('opacity-0', 'scale-95');
  setTimeout(() => {
    menu.classList.add('hidden');
  }, 200);
}

// ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
function closeAllDropdowns() {
  const dropdowns = ['notifications-menu', 'quick-actions-menu', 'user-menu'];
  dropdowns.forEach(id => {
    const menu = document.getElementById(id);
    if (menu && !menu.classList.contains('hidden')) {
      closeDropdown(menu);
    }
  });
  openDropdown = null;
}

// ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
document.addEventListener('click', function(event) {
  if (openDropdown && !openDropdown.parentElement.contains(event.target)) {
    closeAllDropdowns();
  }
});

// Escape í‚¤ë¡œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape' && openDropdown) {
    closeAllDropdowns();
  }
});

console.log('ğŸ“‹ í—¤ë” ìˆœìˆ˜ JavaScript ë“œë¡­ë‹¤ìš´ ì‹œìŠ¤í…œ ë¡œë“œë¨');
</script>