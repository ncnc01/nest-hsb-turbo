{{!-- 스택 비교 페이지 --}}
<turbo-frame id="main-content">
  <div class="space-y-8" x-data="stackComparison()" x-cloak>
    
    {{!-- 헤더 섹션 --}}
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-8 text-white">
      <h1 class="text-3xl font-bold mb-4">웹 개발 스택 비교</h1>
      <p class="text-blue-100 text-lg">
        다양한 웹 개발 기술 스택의 특징과 장단점을 비교하여 프로젝트에 맞는 최적의 선택을 도와드립니다.
      </p>
    </div>

    {{!-- 현재 프로젝트 하이라이트 --}}
    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
      <div class="flex items-center mb-4">
        <span class="text-3xl mr-3">🟢</span>
        <div>
          <h2 class="text-xl font-bold text-green-800">현재 프로젝트: NestJS + Handlebars</h2>
          <p class="text-green-600">TypeScript 기반 엔터프라이즈급 서버사이드 렌더링</p>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
        <div class="bg-white p-4 rounded-lg">
          <div class="text-2xl font-bold text-green-600">강력한 타입 시스템</div>
          <p class="text-sm text-gray-600">TypeScript로 런타임 오류 방지</p>
        </div>
        <div class="bg-white p-4 rounded-lg">
          <div class="text-2xl font-bold text-green-600">SEO 최적화</div>
          <p class="text-sm text-gray-600">서버사이드 렌더링으로 검색엔진 친화적</p>
        </div>
        <div class="bg-white p-4 rounded-lg">
          <div class="text-2xl font-bold text-green-600">엔터프라이즈급</div>
          <p class="text-sm text-gray-600">확장성과 유지보수성 제공</p>
        </div>
      </div>
    </div>

    {{!-- 스택 개요 카드들 --}}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {{#each stacks}}
      <div class="bg-white rounded-xl shadow-lg border hover:shadow-xl transition-shadow duration-300 
                  {{#if currentProject}}ring-2 ring-green-500{{/if}}">
        <div class="p-6">
          <div class="flex items-center mb-4">
            <span class="text-3xl mr-3">{{logo}}</span>
            <div>
              <h3 class="text-lg font-bold">{{name}}</h3>
              <span class="inline-block px-2 py-1 text-xs rounded-full bg-{{color}}-100 text-{{color}}-800">
                {{type}}
              </span>
            </div>
          </div>
          <p class="text-gray-600 text-sm mb-4">{{description}}</p>
          {{#if currentProject}}
          <div class="bg-green-100 text-green-800 text-sm px-3 py-2 rounded-lg">
            ✨ 현재 프로젝트
          </div>
          {{/if}}
        </div>
      </div>
      {{/each}}
    </div>

    {{!-- 비교 매트릭스 --}}
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-6">종합 비교 매트릭스</h2>
      
      {{!-- 탭 네비게이션 --}}
      <div class="flex flex-wrap border-b mb-6">
        <button @click="setActiveTab('matrix')" 
                :class="activeTab === 'matrix' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="px-4 py-2 border-b-2 font-medium">
          종합 매트릭스
        </button>
        <button @click="setActiveTab('performance')" 
                :class="activeTab === 'performance' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="px-4 py-2 border-b-2 font-medium">
          성능 지표
        </button>
        <button @click="setActiveTab('learning')" 
                :class="activeTab === 'learning' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="px-4 py-2 border-b-2 font-medium">
          학습 곡선
        </button>
        <button @click="setActiveTab('ecosystem')" 
                :class="activeTab === 'ecosystem' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="px-4 py-2 border-b-2 font-medium">
          생태계
        </button>
      </div>

      {{!-- 종합 매트릭스 탭 --}}
      <div :class="activeTab === 'matrix' ? 'block' : 'hidden'" class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr class="bg-gray-50">
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-900">기술 스택</th>
              {{#each comparisonMatrix.categories}}
              <th class="px-4 py-3 text-center text-sm font-medium text-gray-900">{{this}}</th>
              {{/each}}
              <th class="px-4 py-3 text-center text-sm font-medium text-gray-900">총점</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {{#each stacks}}
            <tr class="hover:bg-gray-50 {{#if currentProject}}bg-green-50{{/if}}">
              <td class="px-4 py-3">
                <div class="flex items-center">
                  <span class="text-xl mr-2">{{logo}}</span>
                  <div>
                    <div class="font-medium">{{name}}</div>
                    <div class="text-sm text-gray-500">{{type}}</div>
                  </div>
                </div>
              </td>
              {{#each scores}}
              <td class="px-4 py-3 text-center">
                <div class="flex items-center justify-center">
                  <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold
                              {{#if (gte this 8)}}bg-green-100 text-green-800{{else}}
                              {{#if (gte this 6)}}bg-yellow-100 text-yellow-800{{else}}
                              bg-red-100 text-red-800{{/if}}{{/if}}">
                    {{this}}
                  </div>
                </div>
              </td>
              {{/each}}
              <td class="px-4 py-3 text-center">
                <div class="font-bold text-lg">{{totalScore}}</div>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- 성능 지표 탭 --}}
      <div :class="activeTab === 'performance' ? 'block' : 'hidden'" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-blue-50 p-4 rounded-lg">
            <h4 class="font-bold text-blue-800 mb-3">로딩 시간 (초)</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <span class="font-mono text-sm">{{lookup ../performanceMetrics.loadTime id}}s</span>
            </div>
            {{/each}}
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <h4 class="font-bold text-green-800 mb-3">처리량 (req/sec)</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <span class="font-mono text-sm">{{numberFormat (lookup ../performanceMetrics.throughput id)}}</span>
            </div>
            {{/each}}
          </div>
          <div class="bg-purple-50 p-4 rounded-lg">
            <h4 class="font-bold text-purple-800 mb-3">메모리 사용량 (MB)</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <span class="font-mono text-sm">{{lookup ../performanceMetrics.memoryUsage id}}MB</span>
            </div>
            {{/each}}
          </div>
        </div>
      </div>

      {{!-- 학습 곡선 탭 --}}
      <div :class="activeTab === 'learning' ? 'block' : 'hidden'" class="space-y-4">
        {{#each stacks}}
        <div class="border rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <span class="text-xl mr-2">{{logo}}</span>
              <h4 class="font-bold">{{name}}</h4>
            </div>
            <span class="px-3 py-1 text-sm rounded-full bg-gray-100">
              {{lookup ../learningCurve id 'difficulty'}}
            </span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
              <span class="text-gray-600">기초 학습:</span>
              <span class="font-medium">{{lookup ../learningCurve id 'timeToBasic'}}일</span>
            </div>
            <div>
              <span class="text-gray-600">고급 학습:</span>
              <span class="font-medium">{{lookup ../learningCurve id 'timeToAdvanced'}}일</span>
            </div>
            <div class="col-span-2">
              <span class="text-gray-600">선행 지식:</span>
              <span class="font-medium">{{lookup ../learningCurve id 'prerequisites'}}</span>
            </div>
          </div>
        </div>
        {{/each}}
      </div>

      {{!-- 생태계 탭 --}}
      <div :class="activeTab === 'ecosystem' ? 'block' : 'hidden'" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-orange-50 p-4 rounded-lg">
            <h4 class="font-bold text-orange-800 mb-3">패키지 생태계</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <span class="font-mono text-sm">{{numberFormat (lookup ../ecosystemComparison.packageCount id)}}</span>
            </div>
            {{/each}}
          </div>
          <div class="bg-indigo-50 p-4 rounded-lg">
            <h4 class="font-bold text-indigo-800 mb-3">커뮤니티 활성도</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <div class="flex items-center">
                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                  <div class="bg-indigo-600 h-2 rounded-full" 
                       style="width: {{lookup ../ecosystemComparison.communitySize id}}%"></div>
                </div>
                <span class="text-sm">{{lookup ../ecosystemComparison.communitySize id}}%</span>
              </div>
            </div>
            {{/each}}
          </div>
          <div class="bg-teal-50 p-4 rounded-lg">
            <h4 class="font-bold text-teal-800 mb-3">취업 시장</h4>
            {{#each stacks}}
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm">{{name}}</span>
              <div class="flex items-center">
                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                  <div class="bg-teal-600 h-2 rounded-full" 
                       style="width: {{lookup ../ecosystemComparison.jobMarket id}}%"></div>
                </div>
                <span class="text-sm">{{lookup ../ecosystemComparison.jobMarket id}}%</span>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </div>

    {{!-- 용도별 추천 --}}
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-6">프로젝트 유형별 추천</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {{#each useCases}}
        <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
          <h3 class="font-bold text-lg mb-2">{{scenario}}</h3>
          <p class="text-gray-600 text-sm mb-3">{{reasons}}</p>
          <div class="flex flex-wrap gap-2">
            {{#each recommended}}
            <span class="px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-800">
              {{#each ../../stacks}}
                {{#if (eq ../this id)}}{{name}}{{/if}}
              {{/each}}
            </span>
            {{/each}}
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- 결론 및 추천사항 --}}
    <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-8 text-white">
      <h2 class="text-2xl font-bold mb-4">결론 및 추천사항</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-lg font-bold mb-3">NestJS + Handlebars를 선택해야 하는 경우:</h3>
          <ul class="space-y-2 text-green-100">
            <li>• 엔터프라이즈급 웹 애플리케이션 구축</li>
            <li>• TypeScript의 강력한 타입 시스템 활용</li>
            <li>• SEO 최적화가 중요한 프로젝트</li>
            <li>• 확장성과 유지보수성이 중요한 장기 프로젝트</li>
            <li>• 팀 협업과 코드 품질이 중요한 환경</li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-3">다른 스택을 고려해야 하는 경우:</h3>
          <ul class="space-y-2 text-blue-100">
            <li>• <strong>WordPress:</strong> 빠른 콘텐츠 사이트 구축</li>
            <li>• <strong>React SPA:</strong> 고도의 인터랙티브 앱</li>
            <li>• <strong>Rails:</strong> 빠른 프로토타이핑</li>
            <li>• <strong>Spring:</strong> 대규모 Java 기반 시스템</li>
            <li>• <strong>Next.js:</strong> 하이브리드 SSR/SPA</li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</turbo-frame>

<script>
// 스택 비교 데이터
window.stackComparisonData = {
  stacks: {{{json stacks}}},
  comparisonMatrix: {{{json comparisonMatrix}}},
  useCases: {{{json useCases}}},
  performanceMetrics: {{{json performanceMetrics}}},
  learningCurve: {{{json learningCurve}}},
  ecosystemComparison: {{{json ecosystemComparison}}}
};
</script>

<script data-turbo-permanent>
function stackComparison() {
  return {
    activeTab: 'matrix',
    ...window.stackComparisonData,
    
    init() {
      console.log('Stack comparison page initialized');
      console.log('activeTab:', this.activeTab);
      console.log('stacks:', this.stacks);
      console.log('comparisonMatrix:', this.comparisonMatrix);
      
      // 초기 탭 상태 강제 설정
      this.activeTab = 'matrix';
      
      // DOM 업데이트 강제
      this.$nextTick(() => {
        console.log('nextTick - activeTab:', this.activeTab);
      });
    },
    
    setActiveTab(tab) {
      console.log('Setting active tab to:', tab);
      this.activeTab = tab;
    }
  };
}
</script>